# Stripe æ”¯ä»˜é›†æˆè®¾ç½®æŒ‡å—

## ğŸš€ å®Œæˆçš„é›†æˆåŠŸèƒ½

âœ… Stripe Checkout Session é›†æˆ
âœ… æ”¯ä»˜æŒ‰é’®çŠ¶æ€ç®¡ç†ï¼ˆåŠ è½½ã€é”™è¯¯å¤„ç†ï¼‰
âœ… ä¸åŒè®¡åˆ’çš„å¤„ç†é€»è¾‘ï¼ˆå…è´¹ã€ä»˜è´¹ã€ä¼ä¸šï¼‰
âœ… æˆåŠŸé¡µé¢
âœ… æœåŠ¡ç«¯ API è·¯ç”±

## ğŸ“‹ è®¾ç½®æ­¥éª¤

### 1. åˆ›å»º Stripe è´¦æˆ·
1. è®¿é—® [stripe.com](https://stripe.com) å¹¶æ³¨å†Œè´¦æˆ·
2. å®Œæˆè´¦æˆ·éªŒè¯ï¼ˆæµ‹è¯•æ¨¡å¼ä¸‹å¯è·³è¿‡ï¼‰

### 2. è·å– API å¯†é’¥
1. ç™»å½• Stripe Dashboard
2. ç‚¹å‡» "Developers" â†’ "API keys"
3. å¤åˆ¶ä»¥ä¸‹å¯†é’¥ï¼š
   - **Publishable key** (pk_test_... æˆ– pk_live_...)
   - **Secret key** (sk_test_... æˆ– sk_live_...)

### 3. åˆ›å»ºäº§å“å’Œä»·æ ¼
1. åœ¨ Stripe Dashboard ä¸­ç‚¹å‡» "Products"
2. ç‚¹å‡» "Add product"
3. åˆ›å»ºäº§å“ï¼š
   - **Pro Plan**: $49/month
   - **Enterprise Plan**: è‡ªå®šä¹‰ä»·æ ¼
4. å¤åˆ¶æ¯ä¸ªäº§å“çš„ **Price ID** (price_...)

### 4. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
# Stripe Configuration
PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_ä½ çš„å‘å¸ƒå¯†é’¥
STRIPE_SECRET_KEY=sk_test_ä½ çš„ç§å¯†å¯†é’¥

# Stripe Price IDs
STRIPE_PRICE_PRO=price_ä½ çš„Proè®¡åˆ’ä»·æ ¼ID
STRIPE_PRICE_ENTERPRISE=price_ä½ çš„ä¼ä¸šè®¡åˆ’ä»·æ ¼ID

# ç½‘ç«™URL
PUBLIC_SITE_URL=http://localhost:4321
```

### 5. æ›´æ–°ä»·æ ¼ ID
åœ¨ `src/lib/stripe.ts` ä¸­ç¡®ä¿ä»·æ ¼ ID æ­£ç¡®é…ç½®ã€‚

### 6. æµ‹è¯•æ”¯ä»˜æµç¨‹
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`
2. è®¿é—® pricing é¡µé¢
3. ç‚¹å‡» "Subscribe Now" æŒ‰é’®
4. ä½¿ç”¨ Stripe æµ‹è¯•å¡å·ï¼š`4242 4242 4242 4242`

## ğŸ§ª Stripe æµ‹è¯•å¡å·

- **æˆåŠŸæ”¯ä»˜**: 4242 4242 4242 4242
- **éœ€è¦éªŒè¯**: 4000 0025 0000 3155
- **è¢«æ‹’ç»**: 4000 0000 0000 9995
- **è¿‡æœŸæ—¥æœŸ**: ä»»ä½•æœªæ¥æ—¥æœŸ
- **CVC**: ä»»ä½•3ä½æ•°å­—

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ stripe.ts          # Stripe é…ç½®
â”‚   â””â”€â”€ payment.ts         # æ”¯ä»˜å¤„ç†é€»è¾‘
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ PaymentButton.tsx  # æ”¯ä»˜æŒ‰é’®ç»„ä»¶
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ create-checkout-session.ts  # API è·¯ç”±
â”‚   â””â”€â”€ success.astro      # æ”¯ä»˜æˆåŠŸé¡µé¢
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ”¯ä»˜æ¨¡å¼
åœ¨ `create-checkout-session.ts` ä¸­ä¿®æ”¹ `mode` å‚æ•°ï¼š
- `subscription`: è®¢é˜…æ¨¡å¼
- `payment`: ä¸€æ¬¡æ€§ä»˜æ¬¾

### æ·»åŠ å®¢æˆ·ä¿¡æ¯æ”¶é›†
```typescript
customer_email: userEmail, // é¢„å¡«é‚®ç®±
billing_address_collection: 'required', // æ”¶é›†è´¦å•åœ°å€
```

### å¯ç”¨ä¿ƒé”€ä»£ç 
```typescript
allow_promotion_codes: true,
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. âš ï¸ **æ°¸è¿œä¸è¦**åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æš´éœ² Secret Key
2. âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
3. âœ… åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯ webhook ç­¾å
4. âœ… å§‹ç»ˆåœ¨æœåŠ¡ç«¯éªŒè¯æ”¯ä»˜çŠ¶æ€

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹ [Stripe æ–‡æ¡£](https://stripe.com/docs)
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
3. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿— 